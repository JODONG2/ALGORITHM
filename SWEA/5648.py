test = int(input()) 
direction = [(0,0.5),(0,-0.5),(-0.5,0),(0.5,0)]
for t in range(1,test+1):
    cnt = int(input())
    atom = {} 
    for i in range(1,cnt+1): 
        atom[i] = list(map(int,input().split()))
        atom[i][0] = float(atom[i][0])
        atom[i][1] = float(atom[i][1])
    # x,y,d,e
    time = 0 
    change = False 
    key_list = list(atom.keys())
    answer = 0 
    while time<4001 and cnt > 1 : 
        if change : 
            key_list = list(atom.keys())
            change = False 
        check = {} 
        del_key = 0
        for key in key_list : 
            x,y,d,e = atom[key]
            nx,ny = x+direction[d][0], y+direction[d][1] 
            if nx < -1000 or ny <-1000 or 1000<nx or 1000<ny : 
                del atom[key]
                cnt -= 1 
                change = True 
                continue  
            if check.get((nx,ny)) : 
                if del_key == 0 : 
                    del_key = check[(nx,ny)]
                    cnt -= 1
                del atom[key] 
                cnt -= 1 
                change =True 
                answer += e 
            else : 
                check[(nx,ny)] = key
                atom[key][0], atom[key][1] = nx,ny
        if del_key != 0 :
            answer += atom[del_key][3]
            del atom[del_key]
        time+=1 
    print(f"#{t} {answer}")
"""
2
4
-1000 0 3 5
1000 0 2 3
0 1000 1 7
0 -1000 0 9
4
-1 1 3 3
0 1 1 1
0 0 2 2
-1 0 0 9

1
4
-10 0 3 5
10 0 2 3
0 10 1 7
0 -10 0 9

1
2
0 1 3 5 
1 1 2 5

1
1000
0 1000 1 1
1 1000 1 1
2 1000 1 1
3 1000 1 1
4 1000 1 1
5 1000 1 1
6 1000 1 1
7 1000 1 1
8 1000 1 1
9 1000 1 1
10 1000 1 1
11 1000 1 1
12 1000 1 1
13 1000 1 1
14 1000 1 1
15 1000 1 1
16 1000 1 1
17 1000 1 1
18 1000 1 1
19 1000 1 1
20 1000 1 1
21 1000 1 1
22 1000 1 1
23 1000 1 1
24 1000 1 1
25 1000 1 1
26 1000 1 1
27 1000 1 1
28 1000 1 1
29 1000 1 1
30 1000 1 1
31 1000 1 1
32 1000 1 1
33 1000 1 1
34 1000 1 1
35 1000 1 1
36 1000 1 1
37 1000 1 1
38 1000 1 1
39 1000 1 1
40 1000 1 1
41 1000 1 1
42 1000 1 1
43 1000 1 1
44 1000 1 1
45 1000 1 1
46 1000 1 1
47 1000 1 1
48 1000 1 1
49 1000 1 1
50 1000 1 1
51 1000 1 1
52 1000 1 1
53 1000 1 1
54 1000 1 1
55 1000 1 1
56 1000 1 1
57 1000 1 1
58 1000 1 1
59 1000 1 1
60 1000 1 1
61 1000 1 1
62 1000 1 1
63 1000 1 1
64 1000 1 1
65 1000 1 1
66 1000 1 1
67 1000 1 1
68 1000 1 1
69 1000 1 1
70 1000 1 1
71 1000 1 1
72 1000 1 1
73 1000 1 1
74 1000 1 1
75 1000 1 1
76 1000 1 1
77 1000 1 1
78 1000 1 1
79 1000 1 1
80 1000 1 1
81 1000 1 1
82 1000 1 1
83 1000 1 1
84 1000 1 1
85 1000 1 1
86 1000 1 1
87 1000 1 1
88 1000 1 1
89 1000 1 1
90 1000 1 1
91 1000 1 1
92 1000 1 1
93 1000 1 1
94 1000 1 1
95 1000 1 1
96 1000 1 1
97 1000 1 1
98 1000 1 1
99 1000 1 1
100 1000 1 1
101 1000 1 1
102 1000 1 1
103 1000 1 1
104 1000 1 1
105 1000 1 1
106 1000 1 1
107 1000 1 1
108 1000 1 1
109 1000 1 1
110 1000 1 1
111 1000 1 1
112 1000 1 1
113 1000 1 1
114 1000 1 1
115 1000 1 1
116 1000 1 1
117 1000 1 1
118 1000 1 1
119 1000 1 1
120 1000 1 1
121 1000 1 1
122 1000 1 1
123 1000 1 1
124 1000 1 1
125 1000 1 1
126 1000 1 1
127 1000 1 1
128 1000 1 1
129 1000 1 1
130 1000 1 1
131 1000 1 1
132 1000 1 1
133 1000 1 1
134 1000 1 1
135 1000 1 1
136 1000 1 1
137 1000 1 1
138 1000 1 1
139 1000 1 1
140 1000 1 1
141 1000 1 1
142 1000 1 1
143 1000 1 1
144 1000 1 1
145 1000 1 1
146 1000 1 1
147 1000 1 1
148 1000 1 1
149 1000 1 1
150 1000 1 1
151 1000 1 1
152 1000 1 1
153 1000 1 1
154 1000 1 1
155 1000 1 1
156 1000 1 1
157 1000 1 1
158 1000 1 1
159 1000 1 1
160 1000 1 1
161 1000 1 1
162 1000 1 1
163 1000 1 1
164 1000 1 1
165 1000 1 1
166 1000 1 1
167 1000 1 1
168 1000 1 1
169 1000 1 1
170 1000 1 1
171 1000 1 1
172 1000 1 1
173 1000 1 1
174 1000 1 1
175 1000 1 1
176 1000 1 1
177 1000 1 1
178 1000 1 1
179 1000 1 1
180 1000 1 1
181 1000 1 1
182 1000 1 1
183 1000 1 1
184 1000 1 1
185 1000 1 1
186 1000 1 1
187 1000 1 1
188 1000 1 1
189 1000 1 1
190 1000 1 1
191 1000 1 1
192 1000 1 1
193 1000 1 1
194 1000 1 1
195 1000 1 1
196 1000 1 1
197 1000 1 1
198 1000 1 1
199 1000 1 1
200 1000 1 1
201 1000 1 1
202 1000 1 1
203 1000 1 1
204 1000 1 1
205 1000 1 1
206 1000 1 1
207 1000 1 1
208 1000 1 1
209 1000 1 1
210 1000 1 1
211 1000 1 1
212 1000 1 1
213 1000 1 1
214 1000 1 1
215 1000 1 1
216 1000 1 1
217 1000 1 1
218 1000 1 1
219 1000 1 1
220 1000 1 1
221 1000 1 1
222 1000 1 1
223 1000 1 1
224 1000 1 1
225 1000 1 1
226 1000 1 1
227 1000 1 1
228 1000 1 1
229 1000 1 1
230 1000 1 1
231 1000 1 1
232 1000 1 1
233 1000 1 1
234 1000 1 1
235 1000 1 1
236 1000 1 1
237 1000 1 1
238 1000 1 1
239 1000 1 1
240 1000 1 1
241 1000 1 1
242 1000 1 1
243 1000 1 1
244 1000 1 1
245 1000 1 1
246 1000 1 1
247 1000 1 1
248 1000 1 1
249 1000 1 1
250 1000 1 1
251 1000 1 1
252 1000 1 1
253 1000 1 1
254 1000 1 1
255 1000 1 1
256 1000 1 1
257 1000 1 1
258 1000 1 1
259 1000 1 1
260 1000 1 1
261 1000 1 1
262 1000 1 1
263 1000 1 1
264 1000 1 1
265 1000 1 1
266 1000 1 1
267 1000 1 1
268 1000 1 1
269 1000 1 1
270 1000 1 1
271 1000 1 1
272 1000 1 1
273 1000 1 1
274 1000 1 1
275 1000 1 1
276 1000 1 1
277 1000 1 1
278 1000 1 1
279 1000 1 1
280 1000 1 1
281 1000 1 1
282 1000 1 1
283 1000 1 1
284 1000 1 1
285 1000 1 1
286 1000 1 1
287 1000 1 1
288 1000 1 1
289 1000 1 1
290 1000 1 1
291 1000 1 1
292 1000 1 1
293 1000 1 1
294 1000 1 1
295 1000 1 1
296 1000 1 1
297 1000 1 1
298 1000 1 1
299 1000 1 1
300 1000 1 1
301 1000 1 1
302 1000 1 1
303 1000 1 1
304 1000 1 1
305 1000 1 1
306 1000 1 1
307 1000 1 1
308 1000 1 1
309 1000 1 1
310 1000 1 1
311 1000 1 1
312 1000 1 1
313 1000 1 1
314 1000 1 1
315 1000 1 1
316 1000 1 1
317 1000 1 1
318 1000 1 1
319 1000 1 1
320 1000 1 1
321 1000 1 1
322 1000 1 1
323 1000 1 1
324 1000 1 1
325 1000 1 1
326 1000 1 1
327 1000 1 1
328 1000 1 1
329 1000 1 1
330 1000 1 1
331 1000 1 1
332 1000 1 1
333 1000 1 1
334 1000 1 1
335 1000 1 1
336 1000 1 1
337 1000 1 1
338 1000 1 1
339 1000 1 1
340 1000 1 1
341 1000 1 1
342 1000 1 1
343 1000 1 1
344 1000 1 1
345 1000 1 1
346 1000 1 1
347 1000 1 1
348 1000 1 1
349 1000 1 1
350 1000 1 1
351 1000 1 1
352 1000 1 1
353 1000 1 1
354 1000 1 1
355 1000 1 1
356 1000 1 1
357 1000 1 1
358 1000 1 1
359 1000 1 1
360 1000 1 1
361 1000 1 1
362 1000 1 1
363 1000 1 1
364 1000 1 1
365 1000 1 1
366 1000 1 1
367 1000 1 1
368 1000 1 1
369 1000 1 1
370 1000 1 1
371 1000 1 1
372 1000 1 1
373 1000 1 1
374 1000 1 1
375 1000 1 1
376 1000 1 1
377 1000 1 1
378 1000 1 1
379 1000 1 1
380 1000 1 1
381 1000 1 1
382 1000 1 1
383 1000 1 1
384 1000 1 1
385 1000 1 1
386 1000 1 1
387 1000 1 1
388 1000 1 1
389 1000 1 1
390 1000 1 1
391 1000 1 1
392 1000 1 1
393 1000 1 1
394 1000 1 1
395 1000 1 1
396 1000 1 1
397 1000 1 1
398 1000 1 1
399 1000 1 1
400 1000 1 1
401 1000 1 1
402 1000 1 1
403 1000 1 1
404 1000 1 1
405 1000 1 1
406 1000 1 1
407 1000 1 1
408 1000 1 1
409 1000 1 1
410 1000 1 1
411 1000 1 1
412 1000 1 1
413 1000 1 1
414 1000 1 1
415 1000 1 1
416 1000 1 1
417 1000 1 1
418 1000 1 1
419 1000 1 1
420 1000 1 1
421 1000 1 1
422 1000 1 1
423 1000 1 1
424 1000 1 1
425 1000 1 1
426 1000 1 1
427 1000 1 1
428 1000 1 1
429 1000 1 1
430 1000 1 1
431 1000 1 1
432 1000 1 1
433 1000 1 1
434 1000 1 1
435 1000 1 1
436 1000 1 1
437 1000 1 1
438 1000 1 1
439 1000 1 1
440 1000 1 1
441 1000 1 1
442 1000 1 1
443 1000 1 1
444 1000 1 1
445 1000 1 1
446 1000 1 1
447 1000 1 1
448 1000 1 1
449 1000 1 1
450 1000 1 1
451 1000 1 1
452 1000 1 1
453 1000 1 1
454 1000 1 1
455 1000 1 1
456 1000 1 1
457 1000 1 1
458 1000 1 1
459 1000 1 1
460 1000 1 1
461 1000 1 1
462 1000 1 1
463 1000 1 1
464 1000 1 1
465 1000 1 1
466 1000 1 1
467 1000 1 1
468 1000 1 1
469 1000 1 1
470 1000 1 1
471 1000 1 1
472 1000 1 1
473 1000 1 1
474 1000 1 1
475 1000 1 1
476 1000 1 1
477 1000 1 1
478 1000 1 1
479 1000 1 1
480 1000 1 1
481 1000 1 1
482 1000 1 1
483 1000 1 1
484 1000 1 1
485 1000 1 1
486 1000 1 1
487 1000 1 1
488 1000 1 1
489 1000 1 1
490 1000 1 1
491 1000 1 1
492 1000 1 1
493 1000 1 1
494 1000 1 1
495 1000 1 1
496 1000 1 1
497 1000 1 1
498 1000 1 1
499 1000 1 1
500 1000 1 1
501 1000 1 1
502 1000 1 1
503 1000 1 1
504 1000 1 1
505 1000 1 1
506 1000 1 1
507 1000 1 1
508 1000 1 1
509 1000 1 1
510 1000 1 1
511 1000 1 1
512 1000 1 1
513 1000 1 1
514 1000 1 1
515 1000 1 1
516 1000 1 1
517 1000 1 1
518 1000 1 1
519 1000 1 1
520 1000 1 1
521 1000 1 1
522 1000 1 1
523 1000 1 1
524 1000 1 1
525 1000 1 1
526 1000 1 1
527 1000 1 1
528 1000 1 1
529 1000 1 1
530 1000 1 1
531 1000 1 1
532 1000 1 1
533 1000 1 1
534 1000 1 1
535 1000 1 1
536 1000 1 1
537 1000 1 1
538 1000 1 1
539 1000 1 1
540 1000 1 1
541 1000 1 1
542 1000 1 1
543 1000 1 1
544 1000 1 1
545 1000 1 1
546 1000 1 1
547 1000 1 1
548 1000 1 1
549 1000 1 1
550 1000 1 1
551 1000 1 1
552 1000 1 1
553 1000 1 1
554 1000 1 1
555 1000 1 1
556 1000 1 1
557 1000 1 1
558 1000 1 1
559 1000 1 1
560 1000 1 1
561 1000 1 1
562 1000 1 1
563 1000 1 1
564 1000 1 1
565 1000 1 1
566 1000 1 1
567 1000 1 1
568 1000 1 1
569 1000 1 1
570 1000 1 1
571 1000 1 1
572 1000 1 1
573 1000 1 1
574 1000 1 1
575 1000 1 1
576 1000 1 1
577 1000 1 1
578 1000 1 1
579 1000 1 1
580 1000 1 1
581 1000 1 1
582 1000 1 1
583 1000 1 1
584 1000 1 1
585 1000 1 1
586 1000 1 1
587 1000 1 1
588 1000 1 1
589 1000 1 1
590 1000 1 1
591 1000 1 1
592 1000 1 1
593 1000 1 1
594 1000 1 1
595 1000 1 1
596 1000 1 1
597 1000 1 1
598 1000 1 1
599 1000 1 1
600 1000 1 1
601 1000 1 1
602 1000 1 1
603 1000 1 1
604 1000 1 1
605 1000 1 1
606 1000 1 1
607 1000 1 1
608 1000 1 1
609 1000 1 1
610 1000 1 1
611 1000 1 1
612 1000 1 1
613 1000 1 1
614 1000 1 1
615 1000 1 1
616 1000 1 1
617 1000 1 1
618 1000 1 1
619 1000 1 1
620 1000 1 1
621 1000 1 1
622 1000 1 1
623 1000 1 1
624 1000 1 1
625 1000 1 1
626 1000 1 1
627 1000 1 1
628 1000 1 1
629 1000 1 1
630 1000 1 1
631 1000 1 1
632 1000 1 1
633 1000 1 1
634 1000 1 1
635 1000 1 1
636 1000 1 1
637 1000 1 1
638 1000 1 1
639 1000 1 1
640 1000 1 1
641 1000 1 1
642 1000 1 1
643 1000 1 1
644 1000 1 1
645 1000 1 1
646 1000 1 1
647 1000 1 1
648 1000 1 1
649 1000 1 1
650 1000 1 1
651 1000 1 1
652 1000 1 1
653 1000 1 1
654 1000 1 1
655 1000 1 1
656 1000 1 1
657 1000 1 1
658 1000 1 1
659 1000 1 1
660 1000 1 1
661 1000 1 1
662 1000 1 1
663 1000 1 1
664 1000 1 1
665 1000 1 1
666 1000 1 1
667 1000 1 1
668 1000 1 1
669 1000 1 1
670 1000 1 1
671 1000 1 1
672 1000 1 1
673 1000 1 1
674 1000 1 1
675 1000 1 1
676 1000 1 1
677 1000 1 1
678 1000 1 1
679 1000 1 1
680 1000 1 1
681 1000 1 1
682 1000 1 1
683 1000 1 1
684 1000 1 1
685 1000 1 1
686 1000 1 1
687 1000 1 1
688 1000 1 1
689 1000 1 1
690 1000 1 1
691 1000 1 1
692 1000 1 1
693 1000 1 1
694 1000 1 1
695 1000 1 1
696 1000 1 1
697 1000 1 1
698 1000 1 1
699 1000 1 1
700 1000 1 1
701 1000 1 1
702 1000 1 1
703 1000 1 1
704 1000 1 1
705 1000 1 1
706 1000 1 1
707 1000 1 1
708 1000 1 1
709 1000 1 1
710 1000 1 1
711 1000 1 1
712 1000 1 1
713 1000 1 1
714 1000 1 1
715 1000 1 1
716 1000 1 1
717 1000 1 1
718 1000 1 1
719 1000 1 1
720 1000 1 1
721 1000 1 1
722 1000 1 1
723 1000 1 1
724 1000 1 1
725 1000 1 1
726 1000 1 1
727 1000 1 1
728 1000 1 1
729 1000 1 1
730 1000 1 1
731 1000 1 1
732 1000 1 1
733 1000 1 1
734 1000 1 1
735 1000 1 1
736 1000 1 1
737 1000 1 1
738 1000 1 1
739 1000 1 1
740 1000 1 1
741 1000 1 1
742 1000 1 1
743 1000 1 1
744 1000 1 1
745 1000 1 1
746 1000 1 1
747 1000 1 1
748 1000 1 1
749 1000 1 1
750 1000 1 1
751 1000 1 1
752 1000 1 1
753 1000 1 1
754 1000 1 1
755 1000 1 1
756 1000 1 1
757 1000 1 1
758 1000 1 1
759 1000 1 1
760 1000 1 1
761 1000 1 1
762 1000 1 1
763 1000 1 1
764 1000 1 1
765 1000 1 1
766 1000 1 1
767 1000 1 1
768 1000 1 1
769 1000 1 1
770 1000 1 1
771 1000 1 1
772 1000 1 1
773 1000 1 1
774 1000 1 1
775 1000 1 1
776 1000 1 1
777 1000 1 1
778 1000 1 1
779 1000 1 1
780 1000 1 1
781 1000 1 1
782 1000 1 1
783 1000 1 1
784 1000 1 1
785 1000 1 1
786 1000 1 1
787 1000 1 1
788 1000 1 1
789 1000 1 1
790 1000 1 1
791 1000 1 1
792 1000 1 1
793 1000 1 1
794 1000 1 1
795 1000 1 1
796 1000 1 1
797 1000 1 1
798 1000 1 1
799 1000 1 1
800 1000 1 1
801 1000 1 1
802 1000 1 1
803 1000 1 1
804 1000 1 1
805 1000 1 1
806 1000 1 1
807 1000 1 1
808 1000 1 1
809 1000 1 1
810 1000 1 1
811 1000 1 1
812 1000 1 1
813 1000 1 1
814 1000 1 1
815 1000 1 1
816 1000 1 1
817 1000 1 1
818 1000 1 1
819 1000 1 1
820 1000 1 1
821 1000 1 1
822 1000 1 1
823 1000 1 1
824 1000 1 1
825 1000 1 1
826 1000 1 1
827 1000 1 1
828 1000 1 1
829 1000 1 1
830 1000 1 1
831 1000 1 1
832 1000 1 1
833 1000 1 1
834 1000 1 1
835 1000 1 1
836 1000 1 1
837 1000 1 1
838 1000 1 1
839 1000 1 1
840 1000 1 1
841 1000 1 1
842 1000 1 1
843 1000 1 1
844 1000 1 1
845 1000 1 1
846 1000 1 1
847 1000 1 1
848 1000 1 1
849 1000 1 1
850 1000 1 1
851 1000 1 1
852 1000 1 1
853 1000 1 1
854 1000 1 1
855 1000 1 1
856 1000 1 1
857 1000 1 1
858 1000 1 1
859 1000 1 1
860 1000 1 1
861 1000 1 1
862 1000 1 1
863 1000 1 1
864 1000 1 1
865 1000 1 1
866 1000 1 1
867 1000 1 1
868 1000 1 1
869 1000 1 1
870 1000 1 1
871 1000 1 1
872 1000 1 1
873 1000 1 1
874 1000 1 1
875 1000 1 1
876 1000 1 1
877 1000 1 1
878 1000 1 1
879 1000 1 1
880 1000 1 1
881 1000 1 1
882 1000 1 1
883 1000 1 1
884 1000 1 1
885 1000 1 1
886 1000 1 1
887 1000 1 1
888 1000 1 1
889 1000 1 1
890 1000 1 1
891 1000 1 1
892 1000 1 1
893 1000 1 1
894 1000 1 1
895 1000 1 1
896 1000 1 1
897 1000 1 1
898 1000 1 1
899 1000 1 1
900 1000 1 1
901 1000 1 1
902 1000 1 1
903 1000 1 1
904 1000 1 1
905 1000 1 1
906 1000 1 1
907 1000 1 1
908 1000 1 1
909 1000 1 1
910 1000 1 1
911 1000 1 1
912 1000 1 1
913 1000 1 1
914 1000 1 1
915 1000 1 1
916 1000 1 1
917 1000 1 1
918 1000 1 1
919 1000 1 1
920 1000 1 1
921 1000 1 1
922 1000 1 1
923 1000 1 1
924 1000 1 1
925 1000 1 1
926 1000 1 1
927 1000 1 1
928 1000 1 1
929 1000 1 1
930 1000 1 1
931 1000 1 1
932 1000 1 1
933 1000 1 1
934 1000 1 1
935 1000 1 1
936 1000 1 1
937 1000 1 1
938 1000 1 1
939 1000 1 1
940 1000 1 1
941 1000 1 1
942 1000 1 1
943 1000 1 1
944 1000 1 1
945 1000 1 1
946 1000 1 1
947 1000 1 1
948 1000 1 1
949 1000 1 1
950 1000 1 1
951 1000 1 1
952 1000 1 1
953 1000 1 1
954 1000 1 1
955 1000 1 1
956 1000 1 1
957 1000 1 1
958 1000 1 1
959 1000 1 1
960 1000 1 1
961 1000 1 1
962 1000 1 1
963 1000 1 1
964 1000 1 1
965 1000 1 1
966 1000 1 1
967 1000 1 1
968 1000 1 1
969 1000 1 1
970 1000 1 1
971 1000 1 1
972 1000 1 1
973 1000 1 1
974 1000 1 1
975 1000 1 1
976 1000 1 1
977 1000 1 1
978 1000 1 1
979 1000 1 1
980 1000 1 1
981 1000 1 1
982 1000 1 1
983 1000 1 1
984 1000 1 1
985 1000 1 1
986 1000 1 1
987 1000 1 1
988 1000 1 1
989 1000 1 1
990 1000 1 1
991 1000 1 1
992 1000 1 1
993 1000 1 1
994 1000 1 1
995 1000 1 1
996 1000 1 1
997 1000 1 1
998 1000 1 1
999 1000 1 1

"""