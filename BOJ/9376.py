import sys 
from collections import deque 
def f1(start:list)-> int : 
    exit1 = [] 
    exit2 = [] 
    for num,(x,y) in enumerate(start):
        visited = [[float('inf') for _ in range(m)] for _ in range(n)]
        q = deque([(x,y,0,set([(x,y)]))]) 
        if x == 0 or x == n-1 or y == 0 or y == m-1 :
            if num == 0 : 
                exit1 = [(0,set([(x,y)]))] 
                continue 
            else :
                exit2 = [(0,set([(x,y)]))]
                break
        zero = False 
        while q : 
            x,y,cnt,path= q.popleft()
            cnt2 = cnt 
            for px,py in zip(dx,dy):
                nx,ny = x+px,y+py 
                if 0<=nx<n and 0<=ny<m and cnt < visited[nx][ny] and not (nx,ny) in path and maps[nx][ny] != '*' : 
                    visited[nx][ny] = cnt 
                    if nx == 0 or nx == n-1 or ny == 0 or ny == m-1 : 
                        tmp_path = set(list(path))
                        if maps[nx][ny] == "#":
                            cnt2 +=1 
                            tmp_path.add((nx,ny))
                            if num == 0 :
                                exit1.append((cnt+1,tmp_path))
                            else : 
                                exit2.append((cnt+1,tmp_path))
                        else : 
                            if num == 0 :
                                exit1.append((cnt,tmp_path))
                            else:
                                exit2.append((cnt,tmp_path))
                        if cnt2 == 0 : 
                            zero = True 
                            if num == 0 : 
                                exit1 = [(cnt,tmp_path)]
                            else:
                                exit2 = [(cnt,tmp_path)]
                            break 
                    else : 
                        tmp_path = set(list(path))
                        tmp_path.add((nx,ny))           
                        if maps[nx][ny] == '#':
                            q.append((nx,ny,cnt+1,tmp_path))
                        elif maps[nx][ny] == '.' or maps[nx][ny] == '$':
                            q.appendleft((nx,ny,cnt,tmp_path))
            if zero : 
                break 
        print("%%"*20)
        for v in visited:
            print(v)
        print("%%"*20)
    ret = float('inf')
    print(len(exit1))
    print(len(exit2))
    for e1 in exit1:
        if e1[0] > ret :
            continue 
        for e2 in exit2 : 
            print(e1[0], e2[0])
            if e2[0] > ret :
                continue 
            e = e1[1]|e2[1]
            cnt = 0 
            for i,j in e : 
                if maps[i][j] == '#':
                    cnt+=1
                    if ret <= cnt : 
                        break
            ret = min(cnt,ret)
    return ret 

input = sys.stdin.readline
dx = [0,-1,0,1]
dy = [1,0,-1,0]
tc = int(input()) 
ans = [] 
for t in range(tc):
    n,m = map(int,input().split())
    maps = [input()[:-1] for _ in range(n)]
    start = [] 
    for i in range(n):
        for j in range(m):
            if maps[i][j] == '$':
                start.append((i,j))
    an = f1(start)
    print(an)
    ans.append(an)
real_ans = [int(input()) for _ in range(tc)]

for i,(my,ot) in enumerate(zip(ans,real_ans)):
    if my!=ot:
        print('error: ' , i)

"""
1
41 100
####################################################################################################
...................................................................................................#
##################################################################################################.#
#..................................................................................................#
#.##################################################################################################
#..................................................................................................#
##################################################################################################.#
#..................................................................................................#
#.##################################################################################################
#..................................................................................................#
##################################################################################################.#
#..................................................................................................#
#.##################################################################################################
#..................................................................................................#
##################################################################################################.#
#..................................................................................................#
#.##################################################################################################
#..................................................................................................#
##################################################################################################.#
#..................................................................................................#
#.##################################################################################################
#..................................................................................................#
##################################################################################################.#
#..................................................................................................#
#.##################################################################################################
#..................................................................................................#
##################################################################################################.#
#..................................................................................................#
#.##################################################################################################
#..................................................................................................#
##################################################################################################.#
#..................................................................................................#
#.##################################################################################################
#..................................................................................................#
##################################################################################################.#
#..................................................................................................#
#.##################################################################################################
#..................................................................................................#
##################################################################################################.#
#$$................................................................................................#
####################################################################################################


1
5 11
*#*********
*$*...*...*
*$*.*.*.*.*
*...*...*.*
*********.*


1
7 7
***#***
*.....*
*.*.*.*
*#*.*#*
*.*.*.*
*.$.$.*
*******

1
5 7
*#*****
*#.#.#.
*$***.*
*#$.#.*
*******

1
9 9
*#**#**#*
*#**#**#*
*#**#**#*
*#**.**#*
*#*#.#*#*
*$##*##$*
*#*****#*
*.......*
*********

1
100 100
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
#####################################################################$##############################
####################################################################################################
####################################################################################################
####################################################################################################
########################$###########################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
"""